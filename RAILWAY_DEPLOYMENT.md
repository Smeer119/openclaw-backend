# OpenClaw Railway Deployment Guide üöÇ

## Why Railway is Better Than AWS for OpenClaw

‚úÖ **No autopay required** - Pay-as-you-go with $5 free monthly credit  
‚úÖ **Deploy in 10 minutes** - vs 50+ minutes for AWS  
‚úÖ **Auto PostgreSQL** - One-click database, no manual setup  
‚úÖ **Auto HTTPS** - Free SSL certificates  
‚úÖ **GitHub integration** - Auto-deploy on push  
‚úÖ **Simple pricing** - ~$5-10/month vs AWS complexity  

---

## Pre-Deployment Checklist

### 1. Get Your API Keys Ready

You need these 3 API keys:

#### ‚úÖ Gemini API Key (You have this)
- Check your current `.env.local` in cortex folder
- Format: `AIzaSy...`

#### üÜï Pinecone API Key (Get this now)
1. Go to https://www.pinecone.io/
2. Sign up (free)
3. Create new index:
   - **Name**: `cortex-memories`
   - **Dimensions**: `768`
   - **Metric**: `cosine`
   - **Cloud**: `AWS`
   - **Region**: `us-east-1`
4. Copy API key from dashboard

#### üîê Clerk Secret Key (You should have this)
1. Go to https://dashboard.clerk.com/
2. Click your Cortex app
3. Settings ‚Üí API Keys
4. Copy the **Secret Key** (starts with `sk_`)

---

## Railway Deployment Steps

### Step 1: Prepare Your GitHub Repository (5 minutes)

1. **Initialize Git** (if not already done):
```bash
cd C:\Users\Asus\Desktop\cortex\openclaw
git init
git add .
git commit -m "Initial OpenClaw backend"
```

2. **Create GitHub Repository**:
   - Go to https://github.com/new
   - Name: `openclaw-backend`
   - Make it **Private** (recommended)
   - Don't initialize with README (you already have code)
   - Click "Create repository"

3. **Push to GitHub**:
```bash
git remote add origin https://github.com/YOUR_USERNAME/openclaw-backend.git
git branch -M main
git push -u origin main
```

---

### Step 2: Deploy to Railway (5 minutes)

1. **Sign Up**:
   - Go to https://railway.app/
   - Click "Login with GitHub"
   - Authorize Railway

2. **Create New Project**:
   - Click "New Project"
   - Click "Deploy from GitHub repo"
   - Select `openclaw-backend`
   - Railway will auto-detect it's a Node.js app

3. **Add PostgreSQL Database**:
   - In your project dashboard, click "New"
   - Click "Database"
   - Select "PostgreSQL"
   - Railway will create database automatically
   - **Copy the DATABASE_URL** (you'll need this)

---

### Step 3: Configure Environment Variables

In Railway dashboard, go to your service ‚Üí **Variables** tab:

Add these variables:

```env
# Database (Auto-generated by Railway)
DATABASE_URL=${{Postgres.DATABASE_URL}}

# Clerk Authentication
CLERK_SECRET_KEY=sk_test_your_clerk_secret_key_here

# Gemini AI
GEMINI_API_KEY=AIzaSy_your_gemini_api_key_here

# Pinecone Vector DB
PINECONE_API_KEY=your_pinecone_api_key_here
PINECONE_INDEX=cortex-memories

# Server Config
NODE_ENV=production
PORT=3000

# CORS (Update after frontend deployment)
ALLOWED_ORIGINS=https://cortex.yourdomain.com,http://localhost:3000
```

**Important**: Click "Deploy" after adding variables!

---

### Step 4: Configure Build & Deploy

Railway auto-detects your `package.json`, but verify:

1. Go to **Settings** tab
2. Check **Build Command**: 
   ```
   npm install && npx prisma generate && npm run build
   ```

3. Check **Start Command**:
   ```
   npx prisma db push && npm start
   ```

4. Check **Watch Paths**: `./` (deploy on any change)

---

### Step 5: Deploy & Get URL

1. Railway will automatically deploy
2. Wait 2-3 minutes for build
3. Once deployed, go to **Settings** ‚Üí **Networking**
4. Click "Generate Domain"
5. You'll get a URL like: `https://openclaw-production.up.railway.app`

**Save this URL!** You'll need it for Cortex frontend.

---

## Testing Your Deployment

### Test 1: Health Check

```bash
curl https://your-railway-url.up.railway.app/health
```

**Expected response:**
```json
{
  "status": "ok",
  "timestamp": "2026-02-17T...",
  "database": "connected",
  "pinecone": "connected"
}
```

### Test 2: Create Memory (Need Clerk Token)

First, get your Clerk token from Cortex frontend:
1. Open browser DevTools ‚Üí Application ‚Üí Local Storage
2. Find `__clerk_client_jwt`
3. Copy the token

Then test:
```bash
curl -X POST https://your-railway-url.up.railway.app/api/memories \
  -H "Authorization: Bearer YOUR_CLERK_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{\"type\":\"note\",\"content\":\"Railway deployment test!\"}"
```

**Expected response:**
```json
{
  "id": "...",
  "type": "note",
  "content": "Railway deployment test!",
  "embedding": [0.123, ...],
  "createdAt": "..."
}
```

### Test 3: Search

```bash
curl -X POST https://your-railway-url.up.railway.app/api/search \
  -H "Authorization: Bearer YOUR_CLERK_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{\"query\":\"test\",\"searchType\":\"hybrid\"}"
```

---

## Monitoring & Logs

### View Logs:
- Railway dashboard ‚Üí Your service ‚Üí **Deployments** tab
- Click on latest deployment
- Real-time logs appear automatically

### Common Issues:

**Build fails:**
- Check that all dependencies are in `package.json`
- Verify `tsconfig.json` is correct

**Database connection fails:**
- Ensure `DATABASE_URL` is set to `${{Postgres.DATABASE_URL}}`
- Check PostgreSQL database is running

**Prisma errors:**
- Make sure build command includes `npx prisma generate`
- Make sure start command includes `npx prisma db push`

---

## Costs

### Free Tier:
- **$5 free credit/month**
- Covers:
  - Small API with low traffic
  - PostgreSQL database (512 MB)
  - ~500 hours/month execution time

### Paid (if you exceed free tier):
- **Execution time**: $0.000463/min (~$20/month for 24/7)
- **PostgreSQL**: $5/month for 1GB
- **Typical total**: $10-15/month for production use

**Tip**: Start with free tier, upgrade only if needed!

---

## Next Steps

Once OpenClaw is deployed:

1. ‚úÖ **Save your Railway URL**
2. üìù **Update ALLOWED_ORIGINS** in Railway variables with your frontend URL
3. üîÑ **Connect Cortex frontend** to OpenClaw API
4. üß™ **Test all features** (create, search, delete)
5. üì¶ **Migrate existing Convex data** to OpenClaw

---

## Auto-Deploy Setup

Railway automatically deploys when you push to GitHub:

```bash
# Make changes
git add .
git commit -m "Update memory service"
git push

# Railway auto-deploys in 2-3 minutes
```

---

## Custom Domain (Optional)

Want `api.cortex.yourdomain.com` instead of Railway subdomain?

1. Buy domain (Namecheap, GoDaddy, etc.)
2. Railway Settings ‚Üí Networking ‚Üí Custom Domain
3. Add your domain
4. Add CNAME record in your DNS:
   ```
   CNAME api.cortex.yourdomain.com ‚Üí your-app.up.railway.app
   ```
5. Railway auto-provisions SSL certificate

---

## Security Checklist

- [x] Database connection over SSL (Railway default)
- [x] HTTPS enabled (Railway default)
- [x] Clerk JWT authentication (already in code)
- [x] Rate limiting (already in code)
- [x] CORS configured (set in env vars)
- [x] Helmet security headers (already in code)
- [x] Environment variables secured (Railway vault)

---

## Support

- **Railway Docs**: https://docs.railway.app/
- **Railway Discord**: https://discord.gg/railway
- **Railway Status**: https://status.railway.app/

---

**Ready to deploy!** üöÄ

Let me know when you have your API keys ready, and I'll walk you through each step!
